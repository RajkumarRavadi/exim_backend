# ğŸ”„ Detailed Flow Examples - Real Scenarios

## End-to-End Execution Flows with Actual Code

This document shows **exactly what happens** at each step with real code examples.

---

## Example 1: Simple Search Query

### **User Input:** "Show me all customers"

### **Complete Flow:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: User Types Message                                  â”‚
â”‚ Input: "Show me all customers"                              â”‚
â”‚ Location: Frontend UI (ai-chat.html)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Frontend Captures & Sends                           â”‚
â”‚ File: ai_chat.js:250-275                                    â”‚
â”‚                                                              â”‚
â”‚ const handleSendMessage = async () => {                     â”‚
â”‚     const message = "Show me all customers";                â”‚
â”‚     const formData = new FormData();                        â”‚
â”‚     formData.append('message', message);                    â”‚
â”‚     formData.append('session_id', sessionId);               â”‚
â”‚                                                              â”‚
â”‚     const response = await fetch(                           â”‚
â”‚         '/api/method/exim_backend.api.ai_chat.process_chat',â”‚
â”‚         { method: 'POST', body: formData }                  â”‚
â”‚     );                                                       â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Backend Receives Request                            â”‚
â”‚ File: ai_chat.py:342                                        â”‚
â”‚                                                              â”‚
â”‚ @frappe.whitelist(allow_guest=True, methods=["POST"])       â”‚
â”‚ def process_chat():                                         â”‚
â”‚     message = "Show me all customers"                       â”‚
â”‚     session_id = "chat_1762694643173_f2vi6ec0d"            â”‚
â”‚                                                              â”‚
â”‚     # Get conversation history                              â”‚
â”‚     history = get_history(session_id)                       â”‚
â”‚     # Returns: []  (first message)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: Build System Prompt                                 â”‚
â”‚ File: ai_chat.py:515-550                                    â”‚
â”‚                                                              â”‚
â”‚ # Get DocType schemas                                       â”‚
â”‚ doctype_fields_map = {                                      â”‚
â”‚     "Customer": [...fields...],                             â”‚
â”‚     "Item": [...fields...],                                 â”‚
â”‚     "Sales Order": [...fields...]                           â”‚
â”‚ }                                                            â”‚
â”‚                                                              â”‚
â”‚ system_prompt = build_optimized_system_prompt(              â”‚
â”‚     doctype_fields_map                                      â”‚
â”‚ )                                                            â”‚
â”‚                                                              â”‚
â”‚ # Result: 15016 characters, 3754 tokens                     â”‚
â”‚ # Contains: DocType list, field schemas, action examples    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: Prepare Messages for AI                             â”‚
â”‚ File: ai_chat.py:552-562                                    â”‚
â”‚                                                              â”‚
â”‚ messages = [                                                â”‚
â”‚     {                                                        â”‚
â”‚         "role": "system",                                   â”‚
â”‚         "content": system_prompt  # 3754 tokens             â”‚
â”‚     },                                                       â”‚
â”‚     {                                                        â”‚
â”‚         "role": "user",                                     â”‚
â”‚         "content": "Show me all customers"  # 5 tokens      â”‚
â”‚     }                                                        â”‚
â”‚ ]                                                            â”‚
â”‚                                                              â”‚
â”‚ # Total input: 3759 tokens                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: Call AI API                                         â”‚
â”‚ File: ai_chat.py:566                                        â”‚
â”‚                                                              â”‚
â”‚ ai_response = call_ai_api(messages, config)                 â”‚
â”‚                                                              â”‚
â”‚ # Sends to: OpenRouter API or Google Gemini                 â”‚
â”‚ # Model: gpt-4 or gemini-pro                                â”‚
â”‚ # Timeout: 60 seconds                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 7: AI Analyzes Request                                 â”‚
â”‚ AI Model Internal Process:                                  â”‚
â”‚                                                              â”‚
â”‚ 1. Parse user intent: "Show" = list/search                  â”‚
â”‚ 2. Identify entity: "customers" = Customer DocType          â”‚
â”‚ 3. Determine action: dynamic_search                         â”‚
â”‚ 4. Extract filters: {} (no filters = all)                   â”‚
â”‚ 5. Set parameters:                                          â”‚
â”‚    - doctype: "Customer"                                    â”‚
â”‚    - filters: {}                                            â”‚
â”‚    - order_by: "modified desc"                              â”‚
â”‚    - execute_immediately: true (safe read operation)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 8: AI Returns JSON                                     â”‚
â”‚                                                              â”‚
â”‚ AI Response:                                                â”‚
â”‚ ```json                                                     â”‚
â”‚ {                                                            â”‚
â”‚   "action": "dynamic_search",                               â”‚
â”‚   "doctype": "Customer",                                    â”‚
â”‚   "filters": {},                                            â”‚
â”‚   "order_by": "modified desc",                              â”‚
â”‚   "execute_immediately": true                               â”‚
â”‚ }                                                            â”‚
â”‚ ```                                                         â”‚
â”‚                                                              â”‚
â”‚ # Output tokens: 34                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 9: Backend Parses JSON                                 â”‚
â”‚ File: ai_chat.py:612-654                                    â”‚
â”‚                                                              â”‚
â”‚ # Extract JSON from markdown code blocks                    â”‚
â”‚ json_pattern = r'```(?:json)?\s*(\{[\s\S]*?\})\s*```'      â”‚
â”‚ match = re.search(json_pattern, ai_response)                â”‚
â”‚                                                              â”‚
â”‚ if match:                                                   â”‚
â”‚     json_str = match.group(1)                               â”‚
â”‚     suggested_action = json.loads(json_str)                 â”‚
â”‚                                                              â”‚
â”‚ # Result:                                                   â”‚
â”‚ suggested_action = {                                        â”‚
â”‚     "action": "dynamic_search",                             â”‚
â”‚     "doctype": "Customer",                                  â”‚
â”‚     "filters": {},                                          â”‚
â”‚     "order_by": "modified desc",                            â”‚
â”‚     "execute_immediately": true                             â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 10: Return to Frontend                                 â”‚
â”‚ File: ai_chat.py:685-697                                    â”‚
â”‚                                                              â”‚
â”‚ return {                                                    â”‚
â”‚     "status": "success",                                    â”‚
â”‚     "message": ai_response,                                 â”‚
â”‚     "suggested_action": suggested_action,                   â”‚
â”‚     "token_usage": {                                        â”‚
â”‚         "input_tokens": 3759,                               â”‚
â”‚         "output_tokens": 34,                                â”‚
â”‚         "total_tokens": 3793                                â”‚
â”‚     },                                                       â”‚
â”‚     "session_id": session_id                                â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 11: Frontend Receives Response                         â”‚
â”‚ File: ai_chat.js:253-289                                    â”‚
â”‚                                                              â”‚
â”‚ const response = await sendChatMessage(...);                â”‚
â”‚                                                              â”‚
â”‚ console.log('API Response:', response);                     â”‚
â”‚ // {status: 'success', suggested_action: {...}, ...}        â”‚
â”‚                                                              â”‚
â”‚ if (response.suggested_action &&                            â”‚
â”‚     response.suggested_action.execute_immediately) {        â”‚
â”‚     autoExecuteAction(response.suggested_action, message);  â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 12: Auto-Execute Action                                â”‚
â”‚ File: ai_chat.js:1093-1122                                  â”‚
â”‚                                                              â”‚
â”‚ const autoExecuteAction = (action, originalQuestion) => {   â”‚
â”‚     if (action.action === 'dynamic_search') {               â”‚
â”‚         handleDynamicSearch(action);                        â”‚
â”‚     }                                                        â”‚
â”‚ };                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 13: Handler Calls Backend                              â”‚
â”‚ File: ai_chat.js:1294-1334                                  â”‚
â”‚                                                              â”‚
â”‚ const handleDynamicSearch = async (action) => {             â”‚
â”‚     const typingId = showTypingIndicator();                 â”‚
â”‚                                                              â”‚
â”‚     const formData = new FormData();                        â”‚
â”‚     formData.append('doctype', 'Customer');                 â”‚
â”‚     formData.append('filters', JSON.stringify({}));         â”‚
â”‚     formData.append('limit', '20');                         â”‚
â”‚     formData.append('order_by', 'modified desc');           â”‚
â”‚                                                              â”‚
â”‚     const response = await fetch(                           â”‚
â”‚         '/api/method/exim_backend.api.ai_chat.dynamic_search',
â”‚         { method: 'POST', body: formData }                  â”‚
â”‚     );                                                       â”‚
â”‚                                                              â”‚
â”‚     const result = await response.json();                   â”‚
â”‚     hideTypingIndicator(typingId);                          â”‚
â”‚                                                              â”‚
â”‚     displayDynamicSearchResults(result.message, 'Customer');â”‚
â”‚ };                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 14: Backend Executes Search                            â”‚
â”‚ File: ai_chat.py:1178-1254                                  â”‚
â”‚                                                              â”‚
â”‚ @frappe.whitelist(allow_guest=True, methods=["POST"])       â”‚
â”‚ def dynamic_search():                                       â”‚
â”‚     doctype = "Customer"                                    â”‚
â”‚     filters = {}                                            â”‚
â”‚     limit = 20                                              â”‚
â”‚     order_by = "modified desc"                              â”‚
â”‚                                                              â”‚
â”‚     # Get handler for Customer                              â”‚
â”‚     handler = get_handler("Customer")                       â”‚
â”‚                                                              â”‚
â”‚     # Execute search                                        â”‚
â”‚     return handler.search(filters, limit, order_by)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 15: Handler Queries Database                           â”‚
â”‚ File: customer_handler.py                                   â”‚
â”‚                                                              â”‚
â”‚ class CustomerHandler(BaseDocTypeHandler):                  â”‚
â”‚     def search(self, filters, limit, order_by):             â”‚
â”‚         customers = frappe.get_all(                         â”‚
â”‚             "Customer",                                     â”‚
â”‚             filters=filters,  # {}                          â”‚
â”‚             fields=[                                        â”‚
â”‚                 "name",                                     â”‚
â”‚                 "customer_name",                            â”‚
â”‚                 "mobile_no",                                â”‚
â”‚                 "email_id",                                 â”‚
â”‚                 "territory",                                â”‚
â”‚                 "customer_group"                            â”‚
â”‚             ],                                               â”‚
â”‚             limit=20,                                       â”‚
â”‚             order_by="modified desc"                        â”‚
â”‚         )                                                    â”‚
â”‚                                                              â”‚
â”‚         return {                                            â”‚
â”‚             "status": "success",                            â”‚
â”‚             "customers": customers,                         â”‚
â”‚             "count": len(customers)                         â”‚
â”‚         }                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 16: Return Results                                     â”‚
â”‚                                                              â”‚
â”‚ {                                                            â”‚
â”‚   "status": "success",                                      â”‚
â”‚   "customers": [                                            â”‚
â”‚     {                                                        â”‚
â”‚       "name": "CUST-00001",                                 â”‚
â”‚       "customer_name": "ABC Corp",                          â”‚
â”‚       "mobile_no": "1234567890",                            â”‚
â”‚       "email_id": "abc@example.com",                        â”‚
â”‚       "territory": "USA",                                   â”‚
â”‚       "customer_group": "Commercial"                        â”‚
â”‚     },                                                       â”‚
â”‚     {                                                        â”‚
â”‚       "name": "CUST-00002",                                 â”‚
â”‚       "customer_name": "XYZ Ltd",                           â”‚
â”‚       ...                                                    â”‚
â”‚     }                                                        â”‚
â”‚     // ... 18 more customers                                â”‚
â”‚   ],                                                         â”‚
â”‚   "count": 20                                               â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 17: Frontend Displays Results                          â”‚
â”‚ File: ai_chat.js:1337-1474                                  â”‚
â”‚                                                              â”‚
â”‚ const displayDynamicSearchResults = (result, doctype) => {  â”‚
â”‚     let message = `                                         â”‚
â”‚         <p>I found <strong>20 customers</strong></p>        â”‚
â”‚         <div>                                               â”‚
â”‚             <div>                                           â”‚
â”‚                 <div>ABC Corp</div>                         â”‚
â”‚                 <div>ğŸ“± 1234567890 â€¢ ğŸ“§ abc@example.com</div>â”‚
â”‚                 <a href="/app/customer/CUST-00001">         â”‚
â”‚                     View Customer â†’                         â”‚
â”‚                 </a>                                         â”‚
â”‚             </div>                                           â”‚
â”‚             <!-- ... 19 more customers ... -->              â”‚
â”‚         </div>                                               â”‚
â”‚     `;                                                       â”‚
â”‚                                                              â”‚
â”‚     addMessage('ai', message);                              â”‚
â”‚ };                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Result:** âœ… User sees 20 customers with details and links

**Total Time:** ~2-3 seconds
**Tokens Used:** 3793 total (3759 input + 34 output)

---

## Example 2: Create Document Query

### **User Input:** "Create a customer named John with mobile 9945682169"

### **Complete Flow:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1-5: Same as Example 1                                 â”‚
â”‚ (Frontend â†’ Backend â†’ Build Prompt â†’ Send to AI)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: AI Analyzes Create Request                          â”‚
â”‚                                                              â”‚
â”‚ AI Internal Process:                                        â”‚
â”‚ 1. Intent: "Create" = create_document action                â”‚
â”‚ 2. Entity: "customer" = Customer DocType                    â”‚
â”‚ 3. Extract fields:                                          â”‚
â”‚    - "named John" â†’ customer_name: "John"                   â”‚
â”‚    - "mobile 9945682169" â†’ mobile_no: "9945682169"          â”‚
â”‚ 4. Check confidence: LOW (missing required field!)          â”‚
â”‚ 5. Set execute_immediately: false (requires confirmation)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 7: AI Returns Create Action                            â”‚
â”‚                                                              â”‚
â”‚ ```json                                                     â”‚
â”‚ {                                                            â”‚
â”‚   "action": "create_document",                              â”‚
â”‚   "doctype": "Customer",                                    â”‚
â”‚   "fields": {                                               â”‚
â”‚     "customer_name": "John",                                â”‚
â”‚     "mobile_no": "9945682169"                               â”‚
â”‚     // âš ï¸ Missing: customer_type (REQUIRED!)               â”‚
â”‚   },                                                         â”‚
â”‚   "execute_immediately": false                              â”‚
â”‚ }                                                            â”‚
â”‚ ```                                                         â”‚
â”‚                                                              â”‚
â”‚ # Output tokens: 50                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 8: Backend Returns to Frontend                         â”‚
â”‚                                                              â”‚
â”‚ return {                                                    â”‚
â”‚     "status": "success",                                    â”‚
â”‚     "message": "Ready to create customer John...",          â”‚
â”‚     "suggested_action": {                                   â”‚
â”‚         "action": "create_document",                        â”‚
â”‚         "doctype": "Customer",                              â”‚
â”‚         "fields": {...},                                    â”‚
â”‚         "execute_immediately": false                        â”‚
â”‚     }                                                        â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 9: Frontend Shows Execute Button                       â”‚
â”‚ File: ai_chat.js:388-418                                    â”‚
â”‚                                                              â”‚
â”‚ // execute_immediately = false, so show button              â”‚
â”‚ addMessage('ai', cleanMessage, tokenUsage, suggestedAction);â”‚
â”‚                                                              â”‚
â”‚ // This calls createSuggestedActions()                      â”‚
â”‚ // which adds an "Execute" button to the message            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 10: User Clicks "Execute" Button                       â”‚
â”‚                                                              â”‚
â”‚ [User sees button: "Execute: create_document"]              â”‚
â”‚ [User clicks it]                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 11: Execute Action Called                              â”‚
â”‚ File: ai_chat.js:842-886                                    â”‚
â”‚                                                              â”‚
â”‚ const executeAction = async (action) => {                   â”‚
â”‚     if (action.action === 'create_document') {              â”‚
â”‚         await handleCreateDocument(action);                 â”‚
â”‚     }                                                        â”‚
â”‚ };                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 12: Handler Calls Backend                              â”‚
â”‚ File: ai_chat.js:1019-1087                                  â”‚
â”‚                                                              â”‚
â”‚ const handleCreateDocument = async (action) => {            â”‚
â”‚     const typingId = showTypingIndicator();                 â”‚
â”‚                                                              â”‚
â”‚     const formData = new FormData();                        â”‚
â”‚     formData.append('doctype', 'Customer');                 â”‚
â”‚     formData.append('fields', JSON.stringify({              â”‚
â”‚         customer_name: "John",                              â”‚
â”‚         mobile_no: "9945682169"                             â”‚
â”‚     }));                                                     â”‚
â”‚                                                              â”‚
â”‚     const response = await fetch(                           â”‚
â”‚         '/api/method/exim_backend.api.ai_chat.create_document',
â”‚         { method: 'POST', body: formData }                  â”‚
â”‚     );                                                       â”‚
â”‚                                                              â”‚
â”‚     const result = await response.json();                   â”‚
â”‚     hideTypingIndicator(typingId);                          â”‚
â”‚                                                              â”‚
â”‚     // Display result                                       â”‚
â”‚ };                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 13: Backend Receives Create Request                    â”‚
â”‚ File: ai_chat.py:819-893                                    â”‚
â”‚                                                              â”‚
â”‚ @frappe.whitelist(allow_guest=True, methods=["POST"])       â”‚
â”‚ def create_document():                                      â”‚
â”‚     doctype = "Customer"                                    â”‚
â”‚     fields = {                                              â”‚
â”‚         "customer_name": "John",                            â”‚
â”‚         "mobile_no": "9945682169"                           â”‚
â”‚     }                                                        â”‚
â”‚                                                              â”‚
â”‚     # Get handler                                           â”‚
â”‚     handler = get_handler("Customer")                       â”‚
â”‚                                                              â”‚
â”‚     # âš ï¸ PROBLEM: Missing customer_type!                   â”‚
â”‚     return handler.create_document(fields)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 14: Handler Attempts to Create                         â”‚
â”‚ File: customer_handler.py                                   â”‚
â”‚                                                              â”‚
â”‚ class CustomerHandler(BaseDocTypeHandler):                  â”‚
â”‚     def create_document(self, fields):                      â”‚
â”‚         try:                                                â”‚
â”‚             doc = frappe.get_doc({                          â”‚
â”‚                 "doctype": "Customer",                      â”‚
â”‚                 "customer_name": "John",                    â”‚
â”‚                 "mobile_no": "9945682169"                   â”‚
â”‚                 # Missing: customer_type                    â”‚
â”‚             })                                               â”‚
â”‚             doc.insert()  # âŒ FAILS! Validation error      â”‚
â”‚                                                              â”‚
â”‚         except frappe.exceptions.ValidationError as e:      â”‚
â”‚             return {                                        â”‚
â”‚                 "status": "error",                          â”‚
â”‚                 "message": "Customer Type is mandatory"     â”‚
â”‚             }                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 15: Error Returned to Frontend                         â”‚
â”‚                                                              â”‚
â”‚ {                                                            â”‚
â”‚   "status": "error",                                        â”‚
â”‚   "message": "Customer Type is mandatory"                   â”‚
â”‚ }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 16: Frontend Shows Error                               â”‚
â”‚                                                              â”‚
â”‚ addMessage('ai', "âŒ Error: Customer Type is mandatory");   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Result:** âŒ Error - Missing required field!

**This is one of the weaknesses identified!**

---

## Example 3: Complex Query (Current Limitation)

### **User Input:** "Show customers from USA who ordered more than $10,000 last month"

### **What Happens:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Receives Complex Query                                   â”‚
â”‚                                                              â”‚
â”‚ AI tries to fit into existing actions:                      â”‚
â”‚ Option 1: dynamic_search on Customer (filters: territory=USA)
â”‚           âŒ But can't filter by order value                â”‚
â”‚                                                              â”‚
â”‚ Option 2: get_customers_by_order_value (min_value=10000)    â”‚
â”‚           âŒ But can't filter by territory                  â”‚
â”‚                                                              â”‚
â”‚ Option 3: Return generic message                            â”‚
â”‚           âš ï¸ Falls back to conversational response          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI Response (No Action)                                     â”‚
â”‚                                                              â”‚
â”‚ "To find customers from USA with orders over $10,000        â”‚
â”‚  last month, you would need to:                             â”‚
â”‚  1. Filter customers by territory USA                       â”‚
â”‚  2. Check their sales orders from last month                â”‚
â”‚  3. Calculate total order value                             â”‚
â”‚  This requires a custom query."                             â”‚
â”‚                                                              â”‚
â”‚ suggested_action: null                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Result:** âš ï¸ No action taken, just explanation

**This requires the Query Builder improvement!**

---

## Summary of Flows

| Scenario | Success | Tokens | Time | Issues |
|----------|---------|--------|------|--------|
| **Simple Search** | âœ… Works | 3793 | 2-3s | None |
| **Create with Missing Field** | âŒ Fails | 3854 | 2-3s | Validation needed |
| **Complex Query** | âš ï¸ Partial | 3900 | 2-3s | No query builder |

---

**Next:** Implement the improvements from SYSTEM_ARCHITECTURE_DEEP_DIVE.md to fix these issues!


